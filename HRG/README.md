# HRG (Heterogeneous Resource Gathering) Environment

ä¸€ä¸ªä¸“ä¸ºå¤šæ™ºèƒ½ä½“å¼ºåŒ–å­¦ä¹ è®¾è®¡çš„å¼‚æ„èµ„æºæ”¶é›†ç¯å¢ƒï¼Œç”¨äºæµ‹è¯•å’Œè®­ç»ƒå…·æœ‰ä¸åŒè§’è‰²çš„æ™ºèƒ½ä½“å›¢é˜Ÿçš„åä½œèƒ½åŠ›ã€‚

## ğŸŒŸ ç‰¹æ€§

- **å¼‚æ„æ™ºèƒ½ä½“è§’è‰²**ï¼šä¾¦å¯Ÿå…µ(Scout)ã€å·¥äºº(Worker)ã€è¿è¾“è½¦(Transporter)
- **éƒ¨åˆ†å¯è§‚æµ‹ç¯å¢ƒ**ï¼šä¸åŒè§’è‰²å…·æœ‰ä¸åŒçš„è§†é‡èŒƒå›´å’Œèƒ½åŠ›
- **èµ„æºç®¡ç†ç³»ç»Ÿ**ï¼šé‡‘å¸(Gold)å’Œæœ¨æ(Wood)ä¸¤ç§èµ„æºï¼Œå…·æœ‰ä¸åŒä»·å€¼å’Œé‡‡é›†éš¾åº¦
- **CTDEå…¼å®¹**ï¼šæ”¯æŒé›†ä¸­å¼è®­ç»ƒåˆ†å¸ƒå¼æ‰§è¡Œç®—æ³•
- **å¯è§†åŒ–æ”¯æŒ**ï¼šå®æ—¶å¯è§†åŒ–æ™ºèƒ½ä½“è¡Œä¸ºå’Œç¯å¢ƒçŠ¶æ€
- **é«˜åº¦å¯é…ç½®**ï¼šæ”¯æŒå¤šç§éš¾åº¦è®¾ç½®å’Œå®éªŒé…ç½®
- **ç¨³å¥è®¾è®¡**ï¼šé˜²æ­¢å¼‚å¸¸å€¼ï¼Œé€‚åˆå¼ºåŒ–å­¦ä¹ è®­ç»ƒ

## ğŸ“‹ ç¯å¢ƒæè¿°

### ä¸–ç•Œè®¾å®š
- **ç½‘æ ¼ä¸–ç•Œ**ï¼š10Ã—10çš„æ–¹å½¢ç½‘æ ¼ï¼ˆå¯é…ç½®ï¼‰
- **åŸºåœ°ä½ç½®**ï¼šå›ºå®šåœ¨(0, 0)
- **éšœç¢ç‰©**ï¼šéšæœºåˆ†å¸ƒçš„ä¸å¯é€šè¡ŒåŒºåŸŸ
- **è§†é‡æœºåˆ¶**ï¼šåŸºäºå°„çº¿æŠ•å°„çš„æœ‰é™è§†é‡

### æ™ºèƒ½ä½“è§’è‰²

#### ğŸ” ä¾¦å¯Ÿå…µ (Scout) - 2ä¸ª
- **è§†é‡èŒƒå›´**ï¼š5æ ¼
- **ç§»åŠ¨é€Ÿåº¦**ï¼š2æ ¼/æ­¥
- **è´Ÿé‡èƒ½åŠ›**ï¼š0ï¼ˆæ— æ³•é‡‡é›†èµ„æºï¼‰
- **ç‰¹æ®Šèƒ½åŠ›**ï¼šå¿«é€Ÿæ¢ç´¢ï¼Œå‘ç°è¿œç¨‹èµ„æº
- **èƒ½é‡æ¶ˆè€—**ï¼š0.05/æ­¥

#### âš’ï¸ å·¥äºº (Worker) - 3ä¸ª
- **è§†é‡èŒƒå›´**ï¼š3æ ¼
- **ç§»åŠ¨é€Ÿåº¦**ï¼š1æ ¼/æ­¥
- **è´Ÿé‡èƒ½åŠ›**ï¼š2å•ä½
- **é‡‡é›†æ—¶é—´**ï¼š2æ­¥/å•ä½èµ„æº
- **èƒ½é‡æ¶ˆè€—**ï¼š0.02/æ­¥ï¼Œ0.08/é‡‡é›†åŠ¨ä½œ

#### ğŸšš è¿è¾“è½¦ (Transporter) - 1ä¸ª
- **è§†é‡èŒƒå›´**ï¼š4æ ¼
- **ç§»åŠ¨é€Ÿåº¦**ï¼š1.5æ ¼/æ­¥
- **è´Ÿé‡èƒ½åŠ›**ï¼š5å•ä½
- **ä¼ è¾“æ—¶é—´**ï¼š1æ­¥ï¼ˆä¸å·¥äººç›¸é‚»æ—¶ï¼‰
- **èƒ½é‡æ¶ˆè€—**ï¼š0.03/æ­¥ï¼Œ0.1/ä¼ è¾“åŠ¨ä½œ

### èµ„æºé…ç½®

#### ğŸ’° é‡‘çŸ¿ (Gold)
- **æ•°é‡**ï¼š3ä¸ª
- **åˆ†å¸ƒ**ï¼šèšé›†åœ¨åœ°å›¾è¿œç«¯(7-9, 7-9)åŒºåŸŸ
- **ä»·å€¼**ï¼š10åˆ†/å•ä½
- **é‡‡é›†éš¾åº¦**ï¼š4æ­¥/å•ä½ï¼ˆæ¯ä¸ªçŸ¿ç‚¹2å•ä½ï¼‰

#### ğŸªµ æœ¨æ (Wood)
- **æ•°é‡**ï¼š10ä¸ª
- **åˆ†å¸ƒ**ï¼šå‡åŒ€æ•£å¸ƒåœ¨åœ°å›¾(2-8, 2-8)åŒºåŸŸ
- **ä»·å€¼**ï¼š2åˆ†/å•ä½
- **é‡‡é›†éš¾åº¦**ï¼š2æ­¥/å•ä½ï¼ˆæ¯ä¸ªçŸ¿ç‚¹1å•ä½ï¼‰

## ğŸ® åŠ¨ä½œç©ºé—´

æ¯ä¸ªæ™ºèƒ½ä½“æœ‰8ä¸ªç¦»æ•£åŠ¨ä½œï¼š

1. **ä¸Šç§»åŠ¨** (MOVE_NORTH)
2. **ä¸‹ç§»åŠ¨** (MOVE_SOUTH)
3. **å·¦ç§»åŠ¨** (MOVE_WEST)
4. **å³ç§»åŠ¨** (MOVE_EAST)
5. **é‡‡é›†èµ„æº** (GATHER) - ä»…å·¥äººå¯ç”¨
6. **ä¼ è¾“èµ„æº** (TRANSFER) - å·¥äººä¸è¿è¾“è½¦ä¹‹é—´
7. **å­˜æ”¾èµ„æº** (DEPOSIT) - ä»…è¿è¾“è½¦åœ¨åŸºåœ°å¯ç”¨
8. **ç­‰å¾…** (WAIT)

## ğŸ‘ï¸ è§‚å¯Ÿç©ºé—´

æ¯ä¸ªæ™ºèƒ½ä½“çš„è§‚å¯Ÿå‘é‡ä¸º80ç»´ï¼ŒåŒ…å«ï¼š

### è‡ªèº«çŠ¶æ€ (10ç»´)
- ä½ç½®ï¼š(x, y) å½’ä¸€åŒ–åæ ‡
- è§’è‰²IDï¼šone-hotç¼–ç  (3ç»´)
- æºå¸¦èµ„æºï¼š(gold_count, wood_count)
- èƒ½é‡ï¼šenergy/100.0
- åŠ¨ä½œå†·å´ï¼šcooldown/2.0

### è§†é‡å†…å®ä½“ (50ç»´ï¼Œæœ€å¤š10ä¸ªå®ä½“)
æ¯ä¸ªå®ä½“åŒ…å«5ç»´ä¿¡æ¯ï¼š
- ç›¸å¯¹ä½ç½®ï¼š(Î”x, Î”y)
- å®ä½“ç±»å‹ï¼šone-hotç¼–ç  (5ç»´)
- èµ„æºå‰©ä½™é‡ï¼šcount/5.0ï¼ˆä»…èµ„æºç‚¹ï¼‰

### å…¨å±€ä¿¡æ¯ (20ç»´)
- æœ€è¿‘3æ¡æ¶ˆæ¯çš„ç¼–ç 
- åŸºåœ°è·ç¦»ï¼šå½’ä¸€åŒ–å€¼
- å‰©ä½™æ—¶é—´ï¼štime_left/max_time
- å…¶ä»–æ¸¸æˆçŠ¶æ€ä¿¡æ¯

## ğŸ† å¥–åŠ±æœºåˆ¶

### ä¸»è¦å¥–åŠ±
- **å­˜æ”¾èµ„æº**ï¼šèµ„æºä»·å€¼çš„50%
  - é‡‘å¸ï¼š10åˆ† Ã— 50% = 5åˆ†
  - æœ¨æï¼š2åˆ† Ã— 50% = 1åˆ†

### å¡‘é€ å¥–åŠ±
- **é‡‡é›†èµ„æº**ï¼šèµ„æºä»·å€¼çš„10%
- **ä¼ è¾“èµ„æº**ï¼šèµ„æºä»·å€¼çš„5%
- **å‘ç°æ–°èµ„æº**ï¼š0.5åˆ†
- **æˆåŠŸä¼ è¾“**ï¼š0.2åˆ†

### æƒ©ç½šé¡¹
- **æ—¶é—´æƒ©ç½š**ï¼š-0.01/æ­¥
- **æ— æ•ˆç§»åŠ¨**ï¼š-0.1
- **ç¢°æ’æƒ©ç½š**ï¼š-0.05
- **é€šä¿¡æˆæœ¬**ï¼š-0.01/æ¬¡ï¼ˆå¦‚æœå¯ç”¨é€šä¿¡ï¼‰

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºç¡€ä½¿ç”¨

```python
from Env.HRG import create_hrg_env

# åˆ›å»ºç¯å¢ƒ
env = create_hrg_env(difficulty="normal")

# é‡ç½®ç¯å¢ƒ
observations = env.reset()

# æ‰§è¡ŒåŠ¨ä½œ
actions = {agent_id: env.action_space.sample() for agent_id in env.agent_ids}
observations, rewards, dones, infos = env.step(actions)

# å…³é—­ç¯å¢ƒ
env.close()
```

### CTDEç¯å¢ƒä½¿ç”¨

```python
from Env.HRG import create_hrg_ctde_env

# åˆ›å»ºCTDEå…¼å®¹ç¯å¢ƒ
env = create_hrg_ctde_env(
    config_name="normal_ctde",
    global_state_type="concat"
)

# è·å–ç¯å¢ƒä¿¡æ¯
env_info = env.get_env_info()
print(f"Number of agents: {env_info['n_agents']}")
print(f"Global state dimension: {env_info['global_state_dim']}")

# è·å–å…¨å±€çŠ¶æ€
global_state = env.get_global_state()
```

### è‡ªå®šä¹‰é…ç½®

```python
from Env.HRG.env_hrg import HRGConfig, HRGEnv

# åˆ›å»ºè‡ªå®šä¹‰é…ç½®
config = HRGConfig(
    grid_size=12,
    max_steps=300,
    num_gold=5,
    num_wood=15,
    render_mode="human"
)

# åˆ›å»ºç¯å¢ƒ
env = HRGEnv(config)
```

## ğŸ¯ å®éªŒé…ç½®

### éš¾åº¦é¢„è®¾

```python
# ç®€å•æ¨¡å¼ - é€‚åˆåˆå§‹è®­ç»ƒ
env = create_hrg_env(difficulty="easy")

# æ ‡å‡†æ¨¡å¼ - é»˜è®¤è¯„ä¼°é…ç½®
env = create_hrg_env(difficulty="normal")

# å›°éš¾æ¨¡å¼ - æŒ‘æˆ˜æµ‹è¯•
env = create_hrg_env(difficulty="hard")
```

### ä¸“ç”¨é…ç½®

```python
from Env.HRG.config import get_config_by_name

# é€šä¿¡æµ‹è¯•ç¯å¢ƒ
config = get_config_by_name("communication")
env = HRGEnv(config)

# åè°ƒæµ‹è¯•ç¯å¢ƒ
config = get_config_by_name("coordination")
env = HRGEnv(config)

# æ¢ç´¢æµ‹è¯•ç¯å¢ƒ
config = get_config_by_name("exploration")
env = HRGEnv(config)
```

## ğŸ“Š å¯è§†åŒ–

### Pygameå®æ—¶å¯è§†åŒ–

```python
from Env.HRG.env_hrg import HRGConfig
from Env.HRG.renderer import HRGRenderer

config = HRGConfig(render_mode="human")
env = HRGEnv(config)

observations = env.reset()
for step in range(100):
    actions = {agent_id: np.random.randint(0, 8) for agent_id in env.agent_ids}
    obs, rewards, dones, infos = env.step(actions)

    if any(dones.values()):
        break

env.close()
```

### Matplotlibé™æ€å¯è§†åŒ–

```python
from Env.HRG.renderer import MatplotlibRenderer

env = create_hrg_env(difficulty="normal")
env.reset()

renderer = MatplotlibRenderer(grid_size=env.config.grid_size)
renderer.render(env.game_state, save_path="hrg_snapshot.png")
```

## ğŸ§ª æµ‹è¯•å’ŒéªŒè¯

### è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶

```python
from Env.HRG.test_env import run_comprehensive_test

# è¿è¡Œå…¨é¢æµ‹è¯•
test_results = run_comprehensive_test()
```

### å¿«é€Ÿæµ‹è¯•

```python
from Env.HRG.test_env import run_quick_test

# è¿è¡Œå¿«é€ŸåŠŸèƒ½æµ‹è¯•
run_quick_test()
```

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

ç¯å¢ƒæä¾›ä»¥ä¸‹è¯„ä¼°æŒ‡æ ‡ï¼š

```python
# åœ¨infoå­—å…¸ä¸­è·å–
info = env.get_info(agent_id)

# ä¸»è¦æŒ‡æ ‡
'total_score': æ€»å¾—åˆ†
'gold_deposited': å­˜æ”¾çš„é‡‘å¸æ•°é‡
'wood_deposited': å­˜æ”¾çš„æœ¨ææ•°é‡
'step': å½“å‰æ­¥æ•°
```

### æˆåŠŸæŒ‡æ ‡
- **æ€»å¾—åˆ†**ï¼šä¸»è¦è¯„ä¼°æŒ‡æ ‡
- **é‡‘å¸æ”¶é›†ç‡**ï¼šé«˜ä»·å€¼èµ„æºæ”¶é›†æ•ˆç‡
- **æœ¨ææ”¶é›†ç‡**ï¼šåŸºç¡€èµ„æºæ”¶é›†æ•ˆç‡
- **æ¢ç´¢è¦†ç›–ç‡**ï¼šåœ°å›¾æ¢ç´¢ç¨‹åº¦
- **é€šä¿¡æ•ˆç‡**ï¼šå¾—åˆ†ä¸é€šä¿¡æ¬¡æ•°çš„æ¯”å€¼
- **è§’è‰²åˆ©ç”¨ç‡**ï¼šå„è§’è‰²çš„ä½¿ç”¨æ•ˆç‡

## ğŸ”§ é«˜çº§åŠŸèƒ½

### åŠ¨ä½œæ©ç 

```python
# è·å–å¯ç”¨åŠ¨ä½œï¼ˆç”¨äºçº¦æŸåŠ¨ä½œç©ºé—´ï¼‰
for agent_id in env.agent_ids:
    avail_actions = env.get_avail_actions(agent_id)
    # ä»…é€‰æ‹©å¯ç”¨åŠ¨ä½œ
    action = np.random.choice(avail_actions)
    actions[agent_id] = action
```

### ç¯å¢ƒä¿¡æ¯è·å–

```python
# è·å–è¯¦ç»†ç¯å¢ƒä¿¡æ¯
env_info = {
    'n_agents': env.n_agents,
    'agent_ids': env.agent_ids,
    'obs_dims': env.obs_dims,
    'act_dims': env.act_dims,
    'episode_limit': env.config.max_steps
}
```

### å…¨å±€çŠ¶æ€ç±»å‹

```python
# ä¸åŒç±»å‹çš„å…¨å±€çŠ¶æ€è¡¨ç¤º
env_types = [
    create_hrg_ctde_env("normal", global_state_type="concat"),  # æ‹¼æ¥
    create_hrg_ctde_env("normal", global_state_type="mean"),    # å¹³å‡
    create_hrg_ctde_env("normal", global_state_type="max"),     # æœ€å¤§
    create_hrg_ctde_env("normal", global_state_type="attention") # æ³¨æ„åŠ›
]
```

## ğŸ“ ä½¿ç”¨åœºæ™¯

### 1. åŸºç¡€å¤šæ™ºèƒ½ä½“è®­ç»ƒ
- æµ‹è¯•ç®—æ³•åœ¨å¼‚æ„æ™ºèƒ½ä½“ç¯å¢ƒä¸­çš„è¡¨ç°
- éªŒè¯è§’è‰²ç‰¹åŒ–çš„æœ‰æ•ˆæ€§
- è¯„ä¼°åä½œç­–ç•¥å­¦ä¹ 

### 2. é€šä¿¡åè®®å­¦ä¹ 
- æµ‹è¯•æ˜¾å¼é€šä¿¡æœºåˆ¶
- è¯„ä¼°éšå¼åè°ƒè¡Œä¸º
- ç ”ç©¶é€šä¿¡æˆæœ¬ä¸æ•ˆç‡çš„æƒè¡¡

### 3. æ¢ç´¢-åˆ©ç”¨æƒè¡¡
- è¯„ä¼°ä¸åŒæ¢ç´¢ç­–ç•¥
- æµ‹è¯•é•¿æœŸè§„åˆ’èƒ½åŠ›
- éªŒè¯èµ„æºåˆ†é…ä¼˜åŒ–

### 4. è¯¾ç¨‹å­¦ä¹ 
- ä»ç®€å•åˆ°å¤æ‚çš„æ¸è¿›å¼è®­ç»ƒ
- æŠ€èƒ½å­¦ä¹ å’Œè¿ç§»
- éš¾åº¦è‡ªé€‚åº”è°ƒæ•´

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å†…å­˜ç®¡ç†**ï¼šé•¿æ—¶é—´è®­ç»ƒæ—¶æ³¨æ„åŠæ—¶å…³é—­ç¯å¢ƒ
2. **éšæœºç§å­**ï¼šè®¾ç½®ç§å­ä»¥ä¿è¯å®éªŒå¯é‡ç°æ€§
3. **å¯è§†åŒ–æ€§èƒ½**ï¼šå®æ—¶å¯è§†åŒ–ä¼šå½±å“è®­ç»ƒé€Ÿåº¦
4. **åŠ¨ä½œçº¦æŸ**ï¼šå»ºè®®ä½¿ç”¨åŠ¨ä½œæ©ç é¿å…æ— æ•ˆåŠ¨ä½œ
5. **è§‚å¯Ÿç»´åº¦**ï¼šç¡®ä¿è§‚å¯Ÿç©ºé—´ä¸ç®—æ³•è¦æ±‚åŒ¹é…

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤é—®é¢˜æŠ¥å‘Šå’Œæ”¹è¿›å»ºè®®ï¼

### å¼€å‘ç¯å¢ƒè®¾ç½®

```bash
# å®‰è£…ä¾èµ–
pip install numpy pygame matplotlib gymnasium

# è¿è¡Œæµ‹è¯•
python Env/HRG/test_env.py

# ä»£ç é£æ ¼
éµå¾ªPEP 8è§„èŒƒï¼Œæ·»åŠ ç±»å‹æ³¨è§£å’Œæ–‡æ¡£å­—ç¬¦ä¸²
```

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ã€‚

## ğŸ™ è‡´è°¢

æ„Ÿè°¢å¤šæ™ºèƒ½ä½“å¼ºåŒ–å­¦ä¹ ç ”ç©¶ç¤¾åŒºçš„å¯å‘å’Œæ”¯æŒã€‚

---

**HRG Environment v1.0.0**
ä¸“ä¸ºå¤šæ™ºèƒ½ä½“å¼ºåŒ–å­¦ä¹ ç ”ç©¶è®¾è®¡çš„å¼‚æ„èµ„æºæ”¶é›†ç¯å¢ƒ